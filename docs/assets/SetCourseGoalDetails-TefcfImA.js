import{k as Q,an as Z,ar as ae,L as le,aM as te,aq as we,as as ie,o as P,m as $e,p as C,aN as se,ah as Ce,aO as ze,aP as re,l as j,u as J,w as v,G as B,A as U,z as ue,aQ as de,C as e,aR as pe,B as N,a7 as O,X,_ as Y,Q as ee,aC as g,a6 as G,D as A,K as Te,a4 as Ve,ac as Ee,ad as Ie,V as fe,R as Fe,U as R,a5 as ce,O as me,aj as Be,a0 as Se,aH as he,x as F,y as a,H as l,aL as L,aB as D,I as M,aS as q,ax as Ne,aT as be,aU as Re,aI as Me,aJ as Ge,aK as De,aV as qe,aW as oe}from"./index-uDMkNMzh.js";import{E as u,a as E}from"./el-col-DNNA048N.js";import{E as Ue,d as Le}from"./el-form-item-CjLyYdgn.js";import{E as Pe}from"./el-dialog-DAU5n0mE.js";import{E as je}from"./el-input-number-C7XeGStJ.js";import{b as We,a as K}from"./index-C2fBSKFP.js";import"./isUndefined-DCTLXrZ8.js";const ge=Q({modelValue:{type:[String,Number,Boolean],default:void 0},size:ie,disabled:Boolean,label:{type:[String,Number,Boolean],default:void 0},value:{type:[String,Number,Boolean],default:void 0},name:{type:String,default:void 0}}),He=Q({...ge,border:Boolean}),ve={[Z]:d=>ae(d)||le(d)||te(d),[we]:d=>ae(d)||le(d)||te(d)},ye=Symbol("radioGroupKey"),_e=(d,$)=>{const c=P(),n=$e(ye,void 0),f=C(()=>!!n),h=C(()=>se(d.value)?d.label:d.value),t=C({get(){return f.value?n.modelValue:d.modelValue},set(b){f.value?n.changeEvent(b):$&&$(Z,b),c.value.checked=d.modelValue===h.value}}),y=Ce(C(()=>n==null?void 0:n.size)),m=ze(C(()=>n==null?void 0:n.disabled)),w=P(!1),I=C(()=>m.value||f.value&&t.value!==h.value?-1:0);return re({from:"label act as value",replacement:"value",version:"3.0.0",scope:"el-radio",ref:"https://element-plus.org/en-US/component/radio.html"},C(()=>f.value&&se(d.value))),{radioRef:c,isGroup:f,radioGroup:n,focus:w,size:y,disabled:m,tabIndex:I,modelValue:t,actualValue:h}},Ae=["value","name","disabled"],Ke=j({name:"ElRadio"}),Oe=j({...Ke,props:He,emits:ve,setup(d,{emit:$}){const c=d,n=J("radio"),{radioRef:f,radioGroup:h,focus:t,size:y,disabled:m,modelValue:w,actualValue:I}=_e(c,$);function b(){ee(()=>$("change",w.value))}return(r,_)=>{var s;return v(),B("label",{class:N([e(n).b(),e(n).is("disabled",e(m)),e(n).is("focus",e(t)),e(n).is("bordered",r.border),e(n).is("checked",e(w)===e(I)),e(n).m(e(y))])},[U("span",{class:N([e(n).e("input"),e(n).is("disabled",e(m)),e(n).is("checked",e(w)===e(I))])},[ue(U("input",{ref_key:"radioRef",ref:f,"onUpdate:modelValue":_[0]||(_[0]=p=>pe(w)?w.value=p:null),class:N(e(n).e("original")),value:e(I),name:r.name||((s=e(h))==null?void 0:s.name),disabled:e(m),type:"radio",onFocus:_[1]||(_[1]=p=>t.value=!0),onBlur:_[2]||(_[2]=p=>t.value=!1),onChange:b,onClick:_[3]||(_[3]=O(()=>{},["stop"]))},null,42,Ae),[[de,e(w)]]),U("span",{class:N(e(n).e("inner"))},null,2)],2),U("span",{class:N(e(n).e("label")),onKeydown:_[4]||(_[4]=O(()=>{},["stop"]))},[X(r.$slots,"default",{},()=>[g(G(r.label),1)])],34)],2)}}});var Qe=Y(Oe,[["__file","radio.vue"]]);const Ze=Q({...ge}),Je=["value","name","disabled"],Xe=j({name:"ElRadioButton"}),Ye=j({...Xe,props:Ze,setup(d){const $=d,c=J("radio"),{radioRef:n,focus:f,size:h,disabled:t,modelValue:y,radioGroup:m,actualValue:w}=_e($),I=C(()=>({backgroundColor:(m==null?void 0:m.fill)||"",borderColor:(m==null?void 0:m.fill)||"",boxShadow:m!=null&&m.fill?`-1px 0 0 0 ${m.fill}`:"",color:(m==null?void 0:m.textColor)||""}));return(b,r)=>{var _;return v(),B("label",{class:N([e(c).b("button"),e(c).is("active",e(y)===e(w)),e(c).is("disabled",e(t)),e(c).is("focus",e(f)),e(c).bm("button",e(h))])},[ue(U("input",{ref_key:"radioRef",ref:n,"onUpdate:modelValue":r[0]||(r[0]=s=>pe(y)?y.value=s:null),class:N(e(c).be("button","original-radio")),value:e(w),type:"radio",name:b.name||((_=e(m))==null?void 0:_.name),disabled:e(t),onFocus:r[1]||(r[1]=s=>f.value=!0),onBlur:r[2]||(r[2]=s=>f.value=!1),onClick:r[3]||(r[3]=O(()=>{},["stop"]))},null,42,Je),[[de,e(y)]]),U("span",{class:N(e(c).be("button","inner")),style:A(e(y)===e(w)?e(I):{}),onKeydown:r[4]||(r[4]=O(()=>{},["stop"]))},[X(b.$slots,"default",{},()=>[g(G(b.label),1)])],38)],2)}}});var xe=Y(Ye,[["__file","radio-button.vue"]]);const ea=Q({id:{type:String,default:void 0},size:ie,disabled:Boolean,modelValue:{type:[String,Number,Boolean],default:void 0},fill:{type:String,default:""},label:{type:String,default:void 0},textColor:{type:String,default:""},name:{type:String,default:void 0},validateEvent:{type:Boolean,default:!0},...Te(["ariaLabel"])}),aa=ve,la=["id","aria-label","aria-labelledby"],ta=j({name:"ElRadioGroup"}),sa=j({...ta,props:ea,emits:aa,setup(d,{emit:$}){const c=d,n=J("radio"),f=Ve(),h=P(),{formItem:t}=Ee(),{inputId:y,isLabeledByFormItem:m}=Ie(c,{formItemContext:t}),w=b=>{$(Z,b),ee(()=>$("change",b))};fe(()=>{const b=h.value.querySelectorAll("[type=radio]"),r=b[0];!Array.from(b).some(_=>_.checked)&&r&&(r.tabIndex=0)});const I=C(()=>c.name||f.value);return Fe(ye,R({...ce(c),changeEvent:w,name:I})),me(()=>c.modelValue,()=>{c.validateEvent&&(t==null||t.validate("change").catch(b=>Be()))}),re({from:"label",replacement:"aria-label",version:"2.8.0",scope:"el-radio-group",ref:"https://element-plus.org/en-US/component/radio.html"},C(()=>!!c.label)),(b,r)=>(v(),B("div",{id:e(y),ref_key:"radioGroupRef",ref:h,class:N(e(n).b("group")),role:"radiogroup","aria-label":e(m)?void 0:b.label||b.ariaLabel||"radio-group","aria-labelledby":e(m)?e(t).labelId:void 0},[X(b.$slots,"default")],10,la))}});var ke=Y(sa,[["__file","radio-group.vue"]]);Se(Qe,{RadioButton:xe,RadioGroup:ke});const oa=he(ke),na=he(xe),ia={__name:"ItemFormDlg",props:{usedFenshu:{type:Object},usedWeights:{type:Object}},emits:["course-goal-changed"],setup(d,{expose:$,emit:c}){const n=d,f=P("指标点"),h=R({visible:!1,title:C(()=>f.value==="指标点"?"添加毕业要求指标点":"添加考核项")}),t=R({khlx:0,zhichengqiangdu:"M"});ce(n);const y=C(()=>{const x=(1-Number.parseFloat(n.usedWeights[0]).toFixed(2)).toFixed(2);return x<=0?"已没有权重可分配！":`剩余 ${x} 权重可分配`}),m=C(()=>{const x=t.khlx,z=Math.round(100-Math.round(n.usedFenshu[x]));return z<=0?`${t.khlx===0?"过程":"考试"}考核已没有分数可分配！`:`${t.khlx===0?"过程":"考试"}考核最多还余 ${z} 分可分配`}),w=R([{label:"指标点代号",placeholder:"",field:"code",width:"90px",toolTip:{content:"即培养方案中毕业目标要求的序号",placement:"right"}},{label:"支撑强度",field:"zhichengqiangdu",width:"90px",radios:{labels:["L","M","H"],values:["L","M","H"]}},{label:"支撑比例",field:"weight",width:"90px",number:{min:0,max:1,step:.01,precision:2,onNativeInput:x=>{}},toolTip:{content:y,placement:"right"}}]),I=R([{label:"考核类型",placeholder:"0",field:"khlx",width:"90px",radios:{labels:["过程","考试"],values:[0,1]}},{label:"考核名称",field:"khmc",width:"180px"},{label:"所占分值",field:"fenzhi",width:"90px",number:{min:0,max:100,step:1,precision:0,onNativeInput:x=>{}},toolTip:{content:m,placement:"right"}}]),b=C(()=>f.value==="指标点"?w:I),r=P(null),_=R({code:[{required:!0,message:"指标点不能为空",trigger:["blur","change"]},{pattern:/^[\.\d]*$/,message:"指标点格式为代号为序号格式",trigger:["blur","change"]}],zhichengqiangdu:[{required:!0,message:"必须选择支撑强度",trigger:["blur","change"]}],weight:[{required:!0,message:"支撑比例不能为空",trigger:["blur","change"]},{pattern:/^0\.(\d+)$/,message:"必须是0 ~ 1之间的小数",trigger:["blur","change"]}],khlx:[{required:!0,message:"必须选择考核类型",trigger:["blur","change"]}],khmc:[{required:!0,message:"必须填写考核项目名称",trigger:["blur","change"]}],fenzhi:[{required:!0,message:"必须填写考核项目名称",trigger:["blur","change"]},{pattern:/\d+/,message:"必须是0~100之间整数",trigger:["blur","change"]}]}),s=x=>{let z=x;try{z=Number.parseFloat(x)}catch{z=Number.Int(x)}finally{return Number.isNaN(z)?x:z}},p=c;async function i(x){x&&await x.validate((z,o)=>{if(z){const W={};for(let S in t)W[S]=s(t[S]);const H=(Number.parseFloat(n.usedWeights[0])+Number.parseFloat(t.weight)).toFixed(2),V=n.usedFenshu.map(S=>Math.round(S));V[t.khlx]=Math.round(t.fenzhi)+Math.round(V[t.khlx]),f.value==="指标点"&&H>1?q.alert("所有权重之和不能超过 1","错误",{type:"error",confirmButtonText:"确定"}):f.value==="考核项"&&V[0]>100?q.alert("过程考核分值超过100！","错误",{type:"error",confirmButtonText:"确定"}):f.value==="考核项"&&V[1]>100?q.alert("考试考核分值超过100！","错误",{type:"error",confirmButtonText:"确定"}):(p("course-goal-changed",{courseGoalTitle:k,leixing:f.value,data:W}),h.visible=!1)}else console.error(o)})}let k="";const T=(x,z)=>{if(!["指标点","考核项"].includes(x))throw new Error("窗口类型必须是考核点或指标项(ItemFormDlg.vue)");f.value=x,h.visible=!0,k=z};return me(h,x=>{x.visible===!0&&ee(()=>{r&&r.value&&r.value.resetFields()}),setTimeout(()=>r&&r.value&&r.value.resetFields(),1e3)},{immediate:!0}),$({showDialog:T}),(x,z)=>(v(),F(e(Pe),{modelValue:h.visible,"onUpdate:modelValue":z[1]||(z[1]=o=>h.visible=o),title:h.title,style:A({width:"15%",minWidth:(f.value==="指标点","360px")}),"close-on-press-escape":!1,"align-center":!0,"show-close":!0,"before-close":()=>{h.visible=!1},"close-on-click-modal":!1},{footer:a(()=>[l(e(E),{class:"input-row"},{default:a(()=>[l(e(u),{offset:18,span:6},{default:a(()=>[l(e(L),{type:"primary",onClick:z[0]||(z[0]=o=>i(r.value))},{default:a(()=>[g("确定")]),_:1})]),_:1})]),_:1})]),default:a(()=>[l(e(Ue),{model:t,"label-width":"100px",ref_key:"formRef",ref:r,style:{"max-width":"500px"},"validate-on-rule-change":!1,"status-icon":""},{default:a(()=>[(v(!0),B(M,null,D(b.value,o=>(v(),F(e(Le),{label:o.label,rules:_[o.field],prop:o.field,key:o},{default:a(()=>{var W,H;return[l(e(We),{effect:"light",disabled:!("toolTip"in o),content:(W=o==null?void 0:o.toolTip)==null?void 0:W.content,placement:(H=o==null?void 0:o.toolTip)==null?void 0:H.placement},{default:a(()=>["radios"in o?(v(),F(e(oa),{key:0,modelValue:t[o.field],"onUpdate:modelValue":V=>t[o.field]=V,placeholder:o.placeholder,disabled:o.disabled,onChange:()=>o.onchange?o.onchange():null},{default:a(()=>[(v(!0),B(M,null,D(o.radios.labels,(V,S)=>(v(),F(e(na),{value:o.radios.values[S],key:`${V}-${S}`,label:V},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled","onChange"])):"number"in o?(v(),F(e(je),{key:1,modelValue:t[o.field],"onUpdate:modelValue":V=>t[o.field]=V,placeholder:o.placeholder,controls:!1,step:.01,min:o.number.min,max:o.number.max,"step-strictly":!0,precision:o.number.precision,style:A({width:o.width}),onInput:V=>{var S;return(S=o.number)==null?void 0:S.onNativeInput(V)}},null,8,["modelValue","onUpdate:modelValue","placeholder","min","max","precision","style","onInput"])):(v(),F(e(Ne),{key:2,modelValue:t[o.field],"onUpdate:modelValue":V=>t[o.field]=V,placeholder:o.placeholder,style:A({width:o.width})},null,8,["modelValue","onUpdate:modelValue","placeholder","style"]))]),_:2},1032,["disabled","content","placement"])]}),_:2},1032,["label","rules","prop"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue","title","style","before-close"]))}},ra={__name:"ChildItem",props:{type:{type:String,required:!0,validator:d=>["指标点","考核项"].includes(d)},data:{type:Object,required:!0,validator:function(){return!0}}},setup(d){const $=d,c=R([{span:8,field:"code",tagType:"info"},{span:6,field:"zhichengqiangdu",tagType:"info"},{span:6,field:"weight",tagType:"danger"}]),n=R([{span:4,field:"khlx",tagType:"success"},{span:13,field:"khmc",tagType:"success"},{span:4,field:"fenzhi",tagType:"success"}]),f=C(()=>$.type==="指标点"?c:n);return(h,t)=>(v(),F(e(E),{class:"sub-row"},{default:a(()=>[(v(!0),B(M,null,D(f.value,y=>(v(),F(e(u),{span:y.span,key:`${y.span}-${Math.random()}`},{default:a(()=>[l(e(K),{type:d.data.khlx===1?y.tagType:"warning"},{default:a(()=>[g(G(y.field==="khlx"?d.data.khlx===0?"过程":"考试":d.data[y.field]),1)]),_:2},1032,["type"])]),_:2},1032,["span"]))),128)),l(e(u),{span:4,class:"no-border"},{default:a(()=>[l(e(L),{type:"danger",icon:e(Re),onClick:t[0]||(t[0]=y=>h.$emit("delme"))},null,8,["icon"])]),_:1})]),_:1}))}},ne=be(ra,[["__scopeId","data-v-675c7b0b"]]),ua={__name:"SetCourseGoalDetails",setup(d){const{courseGoalCalHelperStore:$}=Me(),{getCourseInfo:c,getCourseGoals:n,tblSubTitle:f}=Ge($),h=P(null),t=R([]);function y(s){for(let p of t)p.title==s.courseGoalTitle&&(s.leixing=="指标点"?p.zhibiaodians.push(s.data):p.kaohes.push(s.data))}function m(s,p,i){for(let k of t)k.title==s&&(p==="指标点"?k.zhibiaodians.splice(i,1):k.kaohes.splice(i,1))}const w=s=>{let p=s.zhibiaodians.reduce((i,k)=>i+k.weight,0);return Number.parseFloat(p.toFixed(2))},I=De();async function b(){for(let p of t)if(p.zhibiaodians.length===0||p.kaohes.length===0)return q.alert("请先完成课程目标信息的设置！","错误",{type:"error",confirmButtonText:"确定"});if(Math.abs(1-parseFloat(r[0]))>.001)return q.alert("支撑系数之和应为 1！","错误",{type:"error",confirmButtonText:"确定"});if(Math.abs(100-Math.round(_.value[0]))>.1)return q.alert("已分配的过程考核分总和应为 100！","错误",{type:"error",confirmButtonText:"确定"});if(Math.abs(100-Math.round(_.value[1]))>.1)return q.alert("已分配的考试考核分总和应该 100！","错误",{type:"error",confirmButtonText:"确定"});const s=new Map;for(let p of t){const i=[],k=[];for(let T of p.zhibiaodians)i.push({code:T.code,weight:T.weight,level:T.zhichengqiangdu});for(let T of p.kaohes)k.push({khlx:T.khlx,khmc:T.khmc,fenzhi:T.fenzhi});s.set(i,k)}$.setCourseGoals(s),I.push({name:"import-student-info"})}const r=C(()=>{let s=0;for(let p of t)for(let i of p.zhibiaodians)s=s+i.weight;return s=s.toFixed(2),[s]}),_=C(()=>{const s=[0,0];for(let p of t)for(let i of p.kaohes)s[i.khlx]=s[i.khlx]+i.fenzhi;return s});return fe(()=>{if(n.value.size>0){let s=0;for(let[p,i]of n.value)t.push({title:`课程目标${s+1}`,zhibiaodians:p,kaohes:i})}else{t.length=c.value.goalNum;for(let s=0;s<t.length;s++)t[s]={title:`课程目标${s+1}`,zhibiaodians:[],kaohes:[]}}console.dir(t)}),(s,p)=>(v(),B(M,null,[l(e(E),null,{default:a(()=>[l(e(u),{offset:2,span:19,innerHTML:e(f),style:{"text-align":"center"}},null,8,["innerHTML"])]),_:1}),l(e(qe),{size:"small","z-index":3e3},{default:a(()=>[l(e(E),{class:"tbl-header",justify:"center"},{default:a(()=>[l(e(u),{span:3,class:"vh-center"},{default:a(()=>[g(" 课程目标 ")]),_:1}),l(e(u),{span:3,class:"vh-center"},{default:a(()=>[g("总支撑比例")]),_:1}),l(e(u),{span:7,class:"flex-vertical"},{default:a(()=>[l(e(E),null,{default:a(()=>[l(e(u),{span:24},{default:a(()=>[g("支撑的毕业要求指标点")]),_:1})]),_:1}),l(e(E),{class:"sub-row"},{default:a(()=>[l(e(u),{span:8},{default:a(()=>[g("指标点代号")]),_:1}),l(e(u),{span:6},{default:a(()=>[g("支撑强度")]),_:1}),l(e(u),{span:6},{default:a(()=>[g("支撑比例")]),_:1}),l(e(u),{span:4,class:"no-border"})]),_:1})]),_:1}),l(e(u),{span:11,class:"flex-vertical"},{default:a(()=>[l(e(E),null,{default:a(()=>[l(e(u),{span:24},{default:a(()=>[g("考核项目信息")]),_:1})]),_:1}),l(e(E),{class:"sub-row"},{default:a(()=>[l(e(u),{span:4},{default:a(()=>[g("考核类型")]),_:1}),l(e(u),{span:13},{default:a(()=>[g("考核名称")]),_:1}),l(e(u),{span:4},{default:a(()=>[g("所占分值")]),_:1}),l(e(u),{span:3,class:"no-border"})]),_:1})]),_:1})]),_:1}),(v(!0),B(M,null,D(t,i=>(v(),F(e(E),{class:"tbl-data",justify:"center",key:i},{default:a(()=>[l(e(u),{span:3,class:"vh-center"},{default:a(()=>[g(G(i.title),1)]),_:2},1024),l(e(u),{span:3,class:"vh-center"},{default:a(()=>[l(e(K),{type:"primary",style:{width:"60px"},size:"default"},{default:a(()=>[g(G(w(i)),1)]),_:2},1024)]),_:2},1024),l(e(u),{span:7,class:"flex-vertical"},{default:a(()=>[(v(!0),B(M,null,D(i.zhibiaodians,(k,T)=>(v(),F(ne,{type:"指标点",data:k,index:T,onDelme:x=>m(i.title,"指标点",T),key:`${i.title}-${k}`},null,8,["data","index","onDelme"]))),128)),l(e(E),null,{default:a(()=>[l(e(u),{span:24},{default:a(()=>[l(e(L),{type:"primary",icon:e(oe),style:{"max-width":"90px"},onClick:k=>h.value.showDialog("指标点",i.title)},{default:a(()=>[g("添加指标点")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l(e(u),{span:11,class:"flex-vertical"},{default:a(()=>[(v(!0),B(M,null,D(i.kaohes,(k,T)=>(v(),F(ne,{type:"考核项",data:k,index:T,onDelme:x=>m(i.title,"考核项",T),key:`${i.title}-${k}-${Math.random()}`},null,8,["data","index","onDelme"]))),128)),l(e(E),null,{default:a(()=>[l(e(u),{span:24},{default:a(()=>[l(e(L),{type:"primary",icon:e(oe),style:{"max-width":"100px"},onClick:k=>h.value.showDialog("考核项",i.title)},{default:a(()=>[g("添加考核项目")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),l(e(E),{class:"tbl-header",justify:"center",style:{"background-color":"var(--el-color-primary-light-9)"}},{default:a(()=>[l(e(u),{span:3,class:"vh-center"},{default:a(()=>[g(" 总计 ")]),_:1}),l(e(u),{span:3,class:"vh-center"},{default:a(()=>[l(e(K),{type:"primary",style:{width:"60px"}},{default:a(()=>[g(G(r.value[0]),1)]),_:1})]),_:1}),l(e(u),{span:7,class:"flex-vertical"}),l(e(u),{span:11,class:"flex-vertical"},{default:a(()=>[l(e(E),{class:"sub-row"},{default:a(()=>[l(e(u),{offset:15,span:6,style:{display:"flex",border:"none","justify-content":"space-around"}},{default:a(()=>[(v(!0),B(M,null,D(_.value,(i,k)=>(v(),F(e(K),{style:{width:"60px","margin-left":"1rem"},type:k===1?"success":"warning",key:`${i}-${Math.random()}`},{default:a(()=>[g(G(i),1)]),_:2},1032,["type"]))),128))]),_:1}),l(e(u),{span:3,class:"no-border"})]),_:1})]),_:1})]),_:1})]),_:1}),l(e(E),{justify:"center",style:{"margin-top":"2rem"}},{default:a(()=>[l(e(u),{span:2},{default:a(()=>[l(e(L),{onClick:p[0]||(p[0]=i=>s.$router.push({name:"set-course-info"}))},{default:a(()=>[g("上一步")]),_:1})]),_:1}),l(e(u),{span:2},{default:a(()=>[l(e(L),{onClick:b},{default:a(()=>[g("下一步")]),_:1})]),_:1})]),_:1}),l(ia,{onCourseGoalChanged:y,usedFenshu:_.value,usedWeights:r.value,ref_key:"dlgRef",ref:h},null,8,["usedFenshu","usedWeights"])],64))}},ga=be(ua,[["__scopeId","data-v-dbde9f73"]]);export{ga as default};
