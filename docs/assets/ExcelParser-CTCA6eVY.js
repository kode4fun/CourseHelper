import{o as S,bi as v,bZ as i,b_ as h,Q as I}from"./index-ythu1LVs.js";/* empty css                   */import{E as k}from"./index-C_WakYEZ.js";let g=null;function C(c){return new Promise((w,n)=>{if(c){const d=new FileReader;d.onload=function(){w(this.result)},d.readAsArrayBuffer(c)}else n("没有文件!")})}const m=S("正在解析Excel文件....");async function F(c){if(!c)return;const w=k.service({fullscreen:!0,text:m});return g||await v(()=>import("./xlsx-CIVhsdtn.js").then(n=>n.x),[]).then(n=>g=n),C(c).then(async n=>{const d=g.read(n,{type:"array"}),E=d.SheetNames[0],p=d.Sheets[E],t=g.utils.sheet_to_json(p,{header:1}),o=t[0].length;m.value="正在解析文件内课程信息...";const a={},N=/班级/.exec(t[1][0])?t[1][0]:t[1][0].replace(new RegExp("(?<=专业：)( +)"),"").replace(/( +)/,e=>`${e}班级：`),x=new Map(N.split(/ +/).map(e=>e.split("："))),[b,j]=x.get("班级").split("级");a.grade=i(b,0),a.banji=j.toString().trim(),a.credits=i(x.get("学分"),0),[...Object.entries({专业:"majority",学期:"seminar",课程名称:"coursename",课程编号:"cid"})].map(([e,s])=>a[s]=x.get(e));const u=new Map;if(p[h(5,o)]&&p[h(5,o)].v.match(/(30\%)|(0\.3)/g))a.cjgc=0;else if(p[h(5,o)]&&p[h(5,o)].v.match(/(50\%)|(0\.5)/g))a.cjgc=1;else throw Error("解析成绩比例分配情况出错！");m.value="正在解析文件内课程目标设置信息...";const l=[t[2],t[4],/^下面各分项/.test(t[5][3])?t[6]:t[5]];for(let e of l)for(let s=0;s<6;s++)s<3?e.shift():e.pop();let y=null;for(let e=0;e<l[0].length;e++){l[0][e]&&(y=l[0][e].replace(/(\r)|(毕业要求指标点)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g).map(f=>f.split(/\*/g)).map(f=>({code:f[0],weight:i(f[1])})),u.set(y,[]));const[s,r]=l[1][e].replace(/(\r)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g);u.get(y).push({type:/过程/.exec(s)?0:1,name:r,points:i(l[2][e])})}m.value="正在解析文件内学生和成绩信息";const _=[];for(let e=7;e<t.length;e++){const s={points:[],scores:[]};for(let r=0;r<o;r++)r===0||r===o-1||(r===1?s.stdId=t[e][r]?t[e][r].toString():"":r===2?s.stdName=t[e][r]:r===o-3?s.scores[0]=i(t[e][r],0):r===o-2?s.scores[1]=i(t[e][r],0):s.points.push(i(t[e][r],0)));s.stdId&&s.stdName&&_.push(s)}if(_.length===0)throw Error("文件中没有学生信息");return a.goalNum=u.size,{readedCourseInfo:a,readedCourseGoals:u,readedStudents:_}}).catch(n=>{throw Error(n)}).finally(()=>{I(()=>w.close())})}export{F as ExcelParser,F as default};
