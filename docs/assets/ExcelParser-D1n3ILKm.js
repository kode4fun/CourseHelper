import{o as j,bi as v,bY as i,bZ as p,Q as C}from"./index-gO_cnXNt.js";/* empty css                   */import{E as I}from"./index-CTEWIjzE.js";let m=null;function O(d){return new Promise((S,n)=>{if(d){const u=new FileReader;u.onload=function(){S(this.result)},u.readAsArrayBuffer(d)}else n("没有文件!")})}const x=j("正在解析Excel文件....");async function R(d){if(!d)return;const S=I.service({fullscreen:!0,text:x});return m||await v(()=>import("./xlsx-CIVhsdtn.js").then(n=>n.x),[]).then(n=>m=n),O(d).then(async n=>{const u=m.read(n,{type:"array"}),k=u.SheetNames[0],c=u.Sheets[k],t=m.utils.sheet_to_json(c,{header:1}),a=t[0].length;x.value="正在解析文件内课程信息...",console.log(`读取 Excel 文件：
excelData ==> %o
workSheet ==> %o`,t,c);const r={},y=/班级/.exec(t[1][0])?t[1][0]:t[1][0].replace(new RegExp("(?<=专业：)( +)"),"").replace(/( +)/,e=>`${e}班级：`),N=new Map(y.split(/ +/).map(e=>e.split("："))),[E,_]=N.get("班级").split("级");r.grade=i(E,0),r.banji=_.toString().trim(),r.credits=i(N.get("学分"),0),[...Object.entries({专业:"majority",学期:"seminar",课程名称:"coursename",课程编号:"cid"})].map(([e,o])=>r[o]=N.get(e));const h=new Map;if(c[p(5,a)]&&c[p(5,a)].v.match(/(30\%)|(0\.3)/g))r.cjgc=0;else if(c[p(5,a)]&&c[p(5,a)].v.match(/(50\%)|(0\.5)/g))r.cjgc=1;else throw Error("解析成绩比例分配情况出错！");x.value="正在解析文件内课程目标设置信息...";const l=[t[2],t[4],/^下面各分项/.test(t[5][3])?t[6]:t[5]];for(let e of l)for(let o=0;o<6;o++)o<3?e.shift():e.pop();let w=null;for(let e=0;e<l[0].length;e++){l[0][e]&&(console.log(l[0][e],e),w=l[0][e].replace(/(\r)|(毕业要求指标点)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g).map(g=>g.split(/\*/g)).map(g=>({code:g[0],weight:i(g[1])})),h.set(w,[]));const[o,s]=l[1][e].replace(/(\r)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g);h.get(w).push({khlx:/过程/.exec(o)?0:1,khmc:s,fenzhi:i(l[2][e])})}x.value="正在解析文件内学生和成绩信息";const f=[];for(let e=7;e<t.length;e++){const o={scores:[]};for(let s=0;s<a;s++)s===0||s===a-1||(s===1?o.stdId=t[e][s]?t[e][s].toString():"":s===2?o.stdName=t[e][s]:s===a-3?o.stdGuocheng=i(t[e][s],0):s===a-2?o.stdKaoshi=i(t[e][s],0):o.scores.push(i(t[e][s],0)));o.stdId&&o.stdName&&f.push(o)}console.dir(f),r.goalNum=h.size;const b={readedCourseInfo:r,readedCourseGoals:h,readedStudents:f};return console.log(`文件内解析的信息：
readedCourseInfo==> %o
readedCourseGoals ==> %o
readedStudents ==> %o`,JSON.parse(JSON.stringify(r)),h,JSON.parse(JSON.stringify(f))),b}).catch(n=>{throw Error(n)}).finally(()=>{C(()=>S.close())})}export{R as ExcelParser,R as default};
