import{o as E,bi as S,bZ as i,b_ as p,Q as v}from"./index-CGxF7N_l.js";/* empty css                   */import{E as I}from"./index-hRzjGDNC.js";let g=null;function C(c){return new Promise((x,n)=>{if(c){const d=new FileReader;d.onload=function(){x(this.result)},d.readAsArrayBuffer(c)}else n("没有文件!")})}const m=E("正在解析Excel文件....");async function F(c){if(!c)return;const x=I.service({fullscreen:!0,text:m});return g||await S(()=>import("./xlsx-CIVhsdtn.js").then(n=>n.x),[]).then(n=>g=n),C(c).then(async n=>{const d=g.read(n,{type:"array"}),N=d.SheetNames[0],u=d.Sheets[N],t=g.utils.sheet_to_json(u,{header:1}),o=t[0].length;m.value="正在解析文件内课程信息...";const a={},b=/班级/.exec(t[1][0])?t[1][0]:t[1][0].replace(new RegExp("(?<=专业：)( +)"),"").replace(/( +)/,e=>`${e}班级：`),w=new Map(b.split(/ +/).map(e=>e.split("："))),[j,y]=w.get("班级").split("级");a.grade=i(j,0),a.banji=y.toString().trim(),a.credits=i(w.get("学分"),0),[...Object.entries({专业:"majority",学期:"seminar",课程名称:"coursename",课程编号:"cid"})].map(([e,s])=>a[s]=w.get(e));const h=new Map;if(u[p(5,o)]&&u[p(5,o)].v.match(/(30\%)|(0\.3)/g))a.cjgc=0;else if(u[p(5,o)]&&u[p(5,o)].v.match(/(50\%)|(0\.5)/g))a.cjgc=1;else throw Error("解析成绩比例分配情况出错！");m.value="正在解析文件内课程目标设置信息...";const l=[t[2],t[4],/^下面各分项/.test(t[5][3])?t[6]:t[5]];for(let e of l)for(let s=0;s<6;s++)s<3?e.shift():e.pop();let _=null;for(let e=0;e<l[0].length;e++){l[0][e]&&(_=l[0][e].replace(/(\r)|(毕业要求指标点)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g).map(f=>f.split(/\*/g)).map(f=>({code:f[0],weight:i(f[1])})),h.set(_,[]));const[s,r]=l[1][e].replace(/(\r)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g);h.get(_).push({khlx:/过程/.exec(s)?0:1,khmc:r,fenzhi:i(l[2][e])})}m.value="正在解析文件内学生和成绩信息";const k=[];for(let e=7;e<t.length;e++){const s={scores:[]};for(let r=0;r<o;r++)r===0||r===o-1||(r===1?s.stdId=t[e][r]?t[e][r].toString():"":r===2?s.stdName=t[e][r]:r===o-3?s.stdGuocheng=i(t[e][r],0):r===o-2?s.stdKaoshi=i(t[e][r],0):s.scores.push(i(t[e][r],0)));s.stdId&&s.stdName&&k.push(s)}return a.goalNum=h.size,{readedCourseInfo:a,readedCourseGoals:h,readedStudents:k}}).catch(n=>{throw Error(n)}).finally(()=>{v(()=>x.close())})}export{F as ExcelParser,F as default};
