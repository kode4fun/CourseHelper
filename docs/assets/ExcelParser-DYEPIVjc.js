import{o as E,bi as S,bY as a,bZ as g,Q as v}from"./index-CmEkj1Lo.js";/* empty css                   */import{E as I}from"./index-BRjqEuDX.js";let m=null;function C(c){return new Promise((x,o)=>{if(c){const d=new FileReader;d.onload=function(){x(this.result)},d.readAsArrayBuffer(c)}else o("没有文件!")})}const w=E("正在解析Excel文件....");async function A(c){if(!c)return;const x=I.service({fullscreen:!0,text:w});return m||await S(()=>import("./xlsx-CIVhsdtn.js").then(o=>o.x),[]).then(o=>m=o),C(c).then(async o=>{const d=m.read(o,{type:"array"}),_=d.SheetNames[0],u=d.Sheets[_],r=m.utils.sheet_to_json(u,{header:1}),n=r[0].length;w.value="正在解析文件内课程信息...";const i=new Map(r[1][0].split(/ +/).map(e=>e.split("："))),[b,j]=i.get("班级").split("级");i.set("年级",a(b,0)),i.set("班级",j.toString().trim()),i.set("学分",a(i.get("学分")),0);const y={专业:"majority",年级:"grade",班级:"banji",学期:"seminar",课程名称:"coursename",课程编号:"cid",学分:"credits"},h={};[...Object.entries(y)].map(([e,t])=>h[t]=i.get(e));const f=new Map;if(u[g(5,n)]&&u[g(5,n)].v.match(/0\.3/g))h.cjgc=0;else if(u[g(5,n)]&&u[g(5,n)].v.match(/0\.5/g))h.cjgc=1;else throw Error("解析成绩比例分配情况出错！");w.value="正在解析文件内课程目标设置信息...";const l=[r[2],r[4],/^下面各分项/.test(r[5][3])?r[6]:r[5]];for(let e of l)for(let t=0;t<6;t++)t<3?e.shift():e.pop();let k=null;for(let e=0;e<l[0].length;e++){l[0][e]!==""&&(k=l[0][e].replace(/(\r)|(毕业要求指标点)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g).map(p=>p.split(/\*/g)).map(p=>({code:p[0],weight:a(p[1])})),f.set(k,[]));const[t,s]=l[1][e].replace(/(\r)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g);f.get(k).push({khlx:t==="过程"?0:1,khmc:s,fenzhi:a(l[2][e])})}w.value="正在解析文件内学生和成绩信息";const N=[];for(let e=7;e<r.length;e++){const t={scores:[]};for(let s=0;s<n;s++)s===0||s===n-1||(s===1?t.stdId=r[e][s]?r[e][s].toString():"":s===2?t.stdName=r[e][s]:s===n-3?t.stdGuocheng=a(r[e][s],0):s===n-2?t.stdKaoshi=a(r[e][s],0):t.scores.push(a(r[e][s],0)));t.stdId&&t.stdName&&N.push(t)}return h.goalNum=f.size,{readedCourseInfo:h,readedCourseGoals:f,readedStudents:N}}).catch(o=>{throw Error(o)}).finally(()=>{v(()=>x.close())})}export{A as ExcelParser,A as default};
