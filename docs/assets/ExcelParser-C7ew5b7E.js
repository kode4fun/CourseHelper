import{o as j,bi as y,bZ as l,b_ as p,Q as v}from"./index-ChBmhNs_.js";/* empty css                   */import{E as I}from"./index-Cc_yF_5l.js";let g=null;function C(d){return new Promise((x,n)=>{if(d){const h=new FileReader;h.onload=function(){x(this.result)},h.readAsArrayBuffer(d)}else n("没有文件!")})}const m=j("正在解析Excel文件....");async function D(d){if(!d)return;const x=I.service({fullscreen:!0,text:m});return g||await y(()=>import("./xlsx-CIVhsdtn.js").then(n=>n.x),[]).then(n=>g=n),C(d).then(async n=>{const h=g.read(n,{type:"array"}),E=h.SheetNames[0],i=h.Sheets[E],t=g.utils.sheet_to_json(i,{header:1}),r=t[0].length;m.value="正在解析文件内课程信息...",console.log(`读取 Excel 文件：
excelData ==> %o
workSheet ==> %o`,t,i);const a={},N=/班级/.exec(t[1][0])?t[1][0]:t[1][0].replace(new RegExp("(?<=专业：)( +)"),"").replace(/( +)/,e=>`${e}班级：`),w=new Map(N.split(/ +/).map(e=>e.split("："))),[S,b]=w.get("班级").split("级");a.grade=l(S,0),a.banji=b.toString().trim(),a.credits=l(w.get("学分"),0),[...Object.entries({专业:"majority",学期:"seminar",课程名称:"coursename",课程编号:"cid"})].map(([e,s])=>a[s]=w.get(e));const u=new Map;if(i[p(5,r)]&&i[p(5,r)].v.match(/(30\%)|(0\.3)/g))a.cjgc=0;else if(i[p(5,r)]&&i[p(5,r)].v.match(/(50\%)|(0\.5)/g))a.cjgc=1;else throw Error("解析成绩比例分配情况出错！");m.value="正在解析文件内课程目标设置信息...";const c=[t[2],t[4],/^下面各分项/.test(t[5][3])?t[6]:t[5]];for(let e of c)for(let s=0;s<6;s++)s<3?e.shift():e.pop();let k=null;for(let e=0;e<c[0].length;e++){c[0][e]&&(k=c[0][e].replace(/(\r)|(毕业要求指标点)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g).map(f=>f.split(/\*/g)).map(f=>({code:f[0],weight:l(f[1])})),u.set(k,[]));const[s,o]=c[1][e].replace(/(\r)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g);u.get(k).push({khlx:/过程/.exec(s)?0:1,khmc:o,fenzhi:l(c[2][e])})}m.value="正在解析文件内学生和成绩信息";const _=[];for(let e=7;e<t.length;e++){const s={scores:[]};for(let o=0;o<r;o++)o===0||o===r-1||(o===1?s.stdId=t[e][o]?t[e][o].toString():"":o===2?s.stdName=t[e][o]:o===r-3?s.stdGuocheng=l(t[e][o],0):o===r-2?s.stdKaoshi=l(t[e][o],0):s.scores.push(l(t[e][o],0)));s.stdId&&s.stdName&&_.push(s)}return a.goalNum=u.size,{readedCourseInfo:a,readedCourseGoals:u,readedStudents:_}}).catch(n=>{throw Error(n)}).finally(()=>{v(()=>x.close())})}export{D as ExcelParser,D as default};
