import{T as K,U as J,S as ae,N as le,am as te,R as $e,W as ie,y as L,i as we,c as w,an as se,J as Ce,ao as ze,ap as re,d as U,u as Q,k as y,l as F,p as q,j as ue,aq as de,f as e,ar as fe,s as V,x as A,m as X,_ as Y,n as ee,a9 as v,q as N,C as Z,e as Ee,F as Te,G as Fe,z as pe,a2 as Se,r as B,h as ce,w as me,ag as Ve,ah as he,aa as S,a6 as a,a5 as l,al as j,a8 as G,a7 as R,as as ge,at as Be,ai as Ie,aj as Re,ak as Me,au as oe,av as Ne}from"./index-D_yE4nD3.js";import{E as D}from"./el-message-box-rQFOc41o.js";import{a as Ge,d as De,E as qe}from"./el-input-C4MnRXfs.js";import"./el-overlay-CGAf0vmE.js";import{E as i,a as z}from"./el-col-e4kdPNEr.js";import{a as je}from"./el-popper-DTUReNm6.js";import{E as Le}from"./el-dialog-B2JPAzqF.js";import{b as Ue,a as Pe,E as H}from"./el-form-item-Imho6ZLW.js";import"./el-tooltip-l0sNRNKZ.js";import"./isUndefined-DCTLXrZ8.js";const be=K({modelValue:{type:[String,Number,Boolean],default:void 0},size:ie,disabled:Boolean,label:{type:[String,Number,Boolean],default:void 0},value:{type:[String,Number,Boolean],default:void 0},name:{type:String,default:void 0}}),We=K({...be,border:Boolean}),ve={[J]:r=>ae(r)||le(r)||te(r),[$e]:r=>ae(r)||le(r)||te(r)},ye=Symbol("radioGroupKey"),_e=(r,k)=>{const c=L(),s=we(ye,void 0),p=w(()=>!!s),d=w(()=>se(r.value)?r.label:r.value),o=w({get(){return p.value?s.modelValue:r.modelValue},set(m){p.value?s.changeEvent(m):k&&k(J,m),c.value.checked=r.modelValue===d.value}}),g=Ce(w(()=>s==null?void 0:s.size)),h=ze(w(()=>s==null?void 0:s.disabled)),_=L(!1),E=w(()=>h.value||p.value&&o.value!==d.value?-1:0);return re({from:"label act as value",replacement:"value",version:"3.0.0",scope:"el-radio",ref:"https://element-plus.org/en-US/component/radio.html"},w(()=>p.value&&se(r.value))),{radioRef:c,isGroup:p,radioGroup:s,focus:_,size:g,disabled:h,tabIndex:E,modelValue:o,actualValue:d}},He=["value","name","disabled"],Ae=U({name:"ElRadio"}),Ke=U({...Ae,props:We,emits:ve,setup(r,{emit:k}){const c=r,s=Q("radio"),{radioRef:p,radioGroup:d,focus:o,size:g,disabled:h,modelValue:_,actualValue:E}=_e(c,k);function m(){ee(()=>k("change",_.value))}return(f,t)=>{var b;return y(),F("label",{class:V([e(s).b(),e(s).is("disabled",e(h)),e(s).is("focus",e(o)),e(s).is("bordered",f.border),e(s).is("checked",e(_)===e(E)),e(s).m(e(g))])},[q("span",{class:V([e(s).e("input"),e(s).is("disabled",e(h)),e(s).is("checked",e(_)===e(E))])},[ue(q("input",{ref_key:"radioRef",ref:p,"onUpdate:modelValue":t[0]||(t[0]=n=>fe(_)?_.value=n:null),class:V(e(s).e("original")),value:e(E),name:f.name||((b=e(d))==null?void 0:b.name),disabled:e(h),type:"radio",onFocus:t[1]||(t[1]=n=>o.value=!0),onBlur:t[2]||(t[2]=n=>o.value=!1),onChange:m,onClick:t[3]||(t[3]=A(()=>{},["stop"]))},null,42,He),[[de,e(_)]]),q("span",{class:V(e(s).e("inner"))},null,2)],2),q("span",{class:V(e(s).e("label")),onKeydown:t[4]||(t[4]=A(()=>{},["stop"]))},[X(f.$slots,"default",{},()=>[v(N(f.label),1)])],34)],2)}}});var Oe=Y(Ke,[["__file","radio.vue"]]);const Ze=K({...be}),Je=["value","name","disabled"],Qe=U({name:"ElRadioButton"}),Xe=U({...Qe,props:Ze,setup(r){const k=r,c=Q("radio"),{radioRef:s,focus:p,size:d,disabled:o,modelValue:g,radioGroup:h,actualValue:_}=_e(k),E=w(()=>({backgroundColor:(h==null?void 0:h.fill)||"",borderColor:(h==null?void 0:h.fill)||"",boxShadow:h!=null&&h.fill?`-1px 0 0 0 ${h.fill}`:"",color:(h==null?void 0:h.textColor)||""}));return(m,f)=>{var t;return y(),F("label",{class:V([e(c).b("button"),e(c).is("active",e(g)===e(_)),e(c).is("disabled",e(o)),e(c).is("focus",e(p)),e(c).bm("button",e(d))])},[ue(q("input",{ref_key:"radioRef",ref:s,"onUpdate:modelValue":f[0]||(f[0]=b=>fe(g)?g.value=b:null),class:V(e(c).be("button","original-radio")),value:e(_),type:"radio",name:m.name||((t=e(h))==null?void 0:t.name),disabled:e(o),onFocus:f[1]||(f[1]=b=>p.value=!0),onBlur:f[2]||(f[2]=b=>p.value=!1),onClick:f[3]||(f[3]=A(()=>{},["stop"]))},null,42,Je),[[de,e(g)]]),q("span",{class:V(e(c).be("button","inner")),style:Z(e(g)===e(_)?e(E):{}),onKeydown:f[4]||(f[4]=A(()=>{},["stop"]))},[X(m.$slots,"default",{},()=>[v(N(m.label),1)])],38)],2)}}});var xe=Y(Xe,[["__file","radio-button.vue"]]);const Ye=K({id:{type:String,default:void 0},size:ie,disabled:Boolean,modelValue:{type:[String,Number,Boolean],default:void 0},fill:{type:String,default:""},label:{type:String,default:void 0},textColor:{type:String,default:""},name:{type:String,default:void 0},validateEvent:{type:Boolean,default:!0},...Ge(["ariaLabel"])}),ea=ve,aa=["id","aria-label","aria-labelledby"],la=U({name:"ElRadioGroup"}),ta=U({...la,props:Ye,emits:ea,setup(r,{emit:k}){const c=r,s=Q("radio"),p=Ee(),d=L(),{formItem:o}=Te(),{inputId:g,isLabeledByFormItem:h}=Fe(c,{formItemContext:o}),_=m=>{k(J,m),ee(()=>k("change",m))};pe(()=>{const m=d.value.querySelectorAll("[type=radio]"),f=m[0];!Array.from(m).some(t=>t.checked)&&f&&(f.tabIndex=0)});const E=w(()=>c.name||p.value);return Se(ye,B({...ce(c),changeEvent:_,name:E})),me(()=>c.modelValue,()=>{c.validateEvent&&(o==null||o.validate("change").catch(m=>De()))}),re({from:"label",replacement:"aria-label",version:"2.8.0",scope:"el-radio-group",ref:"https://element-plus.org/en-US/component/radio.html"},w(()=>!!c.label)),(m,f)=>(y(),F("div",{id:e(g),ref_key:"radioGroupRef",ref:d,class:V(e(s).b("group")),role:"radiogroup","aria-label":e(h)?void 0:m.label||m.ariaLabel||"radio-group","aria-labelledby":e(h)?e(o).labelId:void 0},[X(m.$slots,"default")],10,aa))}});var ke=Y(ta,[["__file","radio-group.vue"]]);Ve(Oe,{RadioButton:xe,RadioGroup:ke});const sa=he(ke),oa=he(xe),na={__name:"ItemFormDlg",props:{usedFenshu:{type:Object},usedWeights:{type:Object}},emits:["course-goal-changed"],setup(r,{expose:k,emit:c}){const s=r,p=L("指标点"),d=B({visible:!1,title:w(()=>p.value==="指标点"?"添加毕业要求指标点":"添加考核项")}),o=B({kaoheleixing:0,zhichengqiangdu:"M"});ce(s);const g=w(()=>{const x=(1-Number.parseFloat(s.usedWeights[0]).toFixed(2)).toFixed(2);return x<=0?"已没有权重可分配！":`剩余 ${x} 权重可分配`}),h=w(()=>{const x=o.kaoheleixing,C=Math.round(100-Math.round(s.usedFenshu[x]));return C<=0?`${o.kaoheleixing===0?"过程":"考试"}考核已没有分数可分配！`:`${o.kaoheleixing===0?"过程":"考试"}考核最多还余 ${C} 分可分配`}),_=B([{label:"指标点代号",placeholder:"",field:"daihao",width:"80px",toolTip:{content:"即培养方案中毕业目标要求的序号",placement:"right"}},{label:"支撑强度",field:"zhichengqiangdu",width:"80px",radios:{labels:["L","M","H"],values:["L","M","H"]}},{label:"支撑比例",field:"zhichengbili",width:"80px",toolTip:{content:g,placement:"right"}}]),E=B([{label:"考核类型",placeholder:"0",field:"kaoheleixing",width:"80px",radios:{labels:["过程","考试"],values:[0,1]}},{label:"考核名称",field:"kaohemingcheng",width:"180px"},{label:"所占分值",field:"suozhanfenzhi",width:"80px",toolTip:{content:h,placement:"right"}}]),m=w(()=>p.value==="指标点"?_:E),f=L(null),t=B({daihao:[{required:!0,message:"指标点不能为空",trigger:["blur","change"]},{pattern:/^(\d+)(\.?)(\d*)$/,message:"格式必须是数字",trigger:["blur","change"]}],zhichengqiangdu:[{required:!0,message:"必须选择支撑强度",trigger:["blur","change"]}],zhichengbili:[{required:!0,message:"支撑比例不能为空",trigger:["blur","change"]},{pattern:/^0\.(\d+)$/,message:"必须是0 ~ 1之间的小数",trigger:["blur","change"]}],kaoheleixing:[{required:!0,message:"必须选择考核类型",trigger:["blur","change"]}],kaohemingcheng:[{required:!0,message:"必须填写考核项目名称",trigger:["blur","change"]}],suozhanfenzhi:[{required:!0,message:"必须填写考核项目名称",trigger:["blur","change"]},{pattern:/\d+/,message:"必须是0~100之间整数",trigger:["blur","change"]}]}),b=x=>{let C=x;try{C=Number.parseFloat(x)}catch{C=Number.Int(x)}finally{return Number.isNaN(C)?x:C}},n=c;async function $(x){x&&await x.validate((C,u)=>{if(C){const P={};for(let M in o)P[M]=b(o[M]);const W=(Number.parseFloat(s.usedWeights[0])+Number.parseFloat(o.zhichengbili)).toFixed(2),T=s.usedFenshu.map(M=>Math.round(M));T[o.kaoheleixing]=Math.round(o.suozhanfenzhi)+Math.round(T[o.kaoheleixing]),p.value==="指标点"&&W>1?D.alert("所有权重之和不能超过 1","错误",{type:"error",confirmButtonText:"确定"}):p.value==="考核项"&&T[0]>100?D.alert("过程考核分值超过100！","错误",{type:"error",confirmButtonText:"确定"}):p.value==="考核项"&&T[1]>100?D.alert("考试考核分值超过100！","错误",{type:"error",confirmButtonText:"确定"}):(n("course-goal-changed",{courseGoalTitle:I,leixing:p.value,data:P}),d.visible=!1)}else console.error(u)})}let I="";const O=(x,C)=>{if(!["指标点","考核项"].includes(x))throw new Error("窗口类型必须是考核点或指标项(ItemFormDlg.vue)");p.value=x,d.visible=!0,I=C};return me(d,x=>{x.visible===!0&&ee(()=>{f&&f.value.resetFields()})},{immediate:!0}),k({showDialog:O}),(x,C)=>(y(),S(e(Le),{modelValue:d.visible,"onUpdate:modelValue":C[1]||(C[1]=u=>d.visible=u),title:d.title,style:Z({width:"15%",minWidth:(p.value==="指标点","360px")}),"close-on-press-escape":!1,"align-center":!0,"show-close":!0,"before-close":()=>{d.visible=!1},"close-on-click-modal":!1},{footer:a(()=>[l(e(z),{class:"input-row"},{default:a(()=>[l(e(i),{offset:18,span:6},{default:a(()=>[l(e(j),{type:"primary",onClick:C[0]||(C[0]=u=>$(f.value))},{default:a(()=>[v("确定")]),_:1})]),_:1})]),_:1})]),default:a(()=>[l(e(Pe),{model:o,"label-width":"100px",ref_key:"formRef",ref:f,style:{"max-width":"500px"},"validate-on-rule-change":!1,"status-icon":""},{default:a(()=>[(y(!0),F(R,null,G(m.value,u=>(y(),S(e(Ue),{label:u.label,rules:t[u.field],prop:u.field,key:u},{default:a(()=>{var P,W;return[l(e(je),{effect:"light",disabled:!("toolTip"in u),content:(P=u==null?void 0:u.toolTip)==null?void 0:P.content,placement:(W=u==null?void 0:u.toolTip)==null?void 0:W.placement},{default:a(()=>["radios"in u?(y(),S(e(sa),{key:0,modelValue:o[u.field],"onUpdate:modelValue":T=>o[u.field]=T,placeholder:u.placeholder,disabled:u.disabled,onChange:()=>u.onchange?u.onchange():null},{default:a(()=>[(y(!0),F(R,null,G(u.radios.labels,(T,M)=>(y(),S(e(oa),{value:u.radios.values[M],key:`${T}-${M}`,label:T},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled","onChange"])):(y(),S(e(qe),{key:1,modelValue:o[u.field],"onUpdate:modelValue":T=>o[u.field]=T,placeholder:u.placeholder,style:Z({width:u.width})},null,8,["modelValue","onUpdate:modelValue","placeholder","style"]))]),_:2},1032,["disabled","content","placement"])]}),_:2},1032,["label","rules","prop"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue","title","style","before-close"]))}},ia={__name:"ChildItem",props:{type:{type:String,required:!0,validator:r=>["指标点","考核项"].includes(r)},data:{type:Object,required:!0,validator:function(){return!0}}},setup(r){const k=r,c=B([{span:8,field:"daihao",tagType:"info"},{span:6,field:"zhichengqiangdu",tagType:"info"},{span:6,field:"zhichengbili",tagType:"danger"}]),s=B([{span:4,field:"kaoheleixing",tagType:"success"},{span:13,field:"kaohemingcheng",tagType:"success"},{span:4,field:"suozhanfenzhi",tagType:"success"}]),p=w(()=>k.type==="指标点"?c:s);return(d,o)=>(y(),S(e(z),{class:"sub-row"},{default:a(()=>[(y(!0),F(R,null,G(p.value,g=>(y(),S(e(i),{span:g.span,key:`${g.span}-${Math.random()}`},{default:a(()=>[l(e(H),{type:r.data.kaoheleixing===1?g.tagType:"warning"},{default:a(()=>[v(N(g.field==="kaoheleixing"?r.data.kaoheleixing===0?"过程":"考试":r.data[g.field]),1)]),_:2},1032,["type"])]),_:2},1032,["span"]))),128)),l(e(i),{span:4,class:"no-border"},{default:a(()=>[l(e(j),{type:"danger",icon:e(Be),onClick:o[0]||(o[0]=g=>d.$emit("delme"))},null,8,["icon"])]),_:1})]),_:1}))}},ne=ge(ia,[["__scopeId","data-v-f58392ab"]]),ra={__name:"SetCourseGoalDetails",setup(r){const{courseGoalCalHelperStore:k}=Ie(),{getCourseGoals:c,tblSubTitle:s}=Re(k),p=L(null),d=B([]);function o(t){for(let b of d)b.title==t.courseGoalTitle&&(t.leixing=="指标点"?b.zhibiaodians.push(t.data):b.kaohes.push(t.data))}function g(t,b,n){for(let $ of d)$.title==t&&(b==="指标点"?$.zhibiaodians.splice(n,1):$.kaohes.splice(n,1))}const h=t=>{let b=t.zhibiaodians.reduce((n,$)=>n+$.zhichengbili,0);return Number.parseFloat(b.toFixed(2))},_=Me();async function E(){for(let t of d)if(t.zhibiaodians.length===0||t.kaohes.length===0)return D.alert("请先完成数据填写！","错误",{type:"error",confirmButtonText:"确定"});if(Math.abs(1-parseFloat(m[0]))>.001)return D.alert("支撑系数之和应为 1！","错误",{type:"error",confirmButtonText:"确定"});if(Math.abs(100-Math.round(f.value[0]))>.1)return D.alert("已分配的过程考核分总和应为 100！","错误",{type:"error",confirmButtonText:"确定"});if(Math.abs(100-Math.round(f.value[1]))>.1)return D.alert("已分配的考试考核分总和应该 100！","错误",{type:"error",confirmButtonText:"确定"});k.setCourseGoals(d),_.push({name:"import-exam-result"})}const m=w(()=>{let t=0;for(let b of d)for(let n of b.zhibiaodians)t=t+n.zhichengbili;return t=t.toFixed(2),[t]}),f=w(()=>{const t=[0,0];for(let b of d)for(let n of b.kaohes)t[n.kaoheleixing]=t[n.kaoheleixing]+n.suozhanfenzhi;return t});return pe(()=>{for(let t of c.value)d.push(t)}),(t,b)=>(y(),F(R,null,[l(e(z),null,{default:a(()=>[l(e(i),{offset:2,span:19,innerHTML:e(s),style:{"text-align":"center"}},null,8,["innerHTML"])]),_:1}),l(e(Ne),{size:"small","z-index":3e3},{default:a(()=>[l(e(z),{class:"tbl-header",justify:"center"},{default:a(()=>[l(e(i),{span:3,class:"vh-center"},{default:a(()=>[v(" 课程目标 ")]),_:1}),l(e(i),{span:3,class:"vh-center"},{default:a(()=>[v("总支撑比例")]),_:1}),l(e(i),{span:7,class:"flex-vertical"},{default:a(()=>[l(e(z),null,{default:a(()=>[l(e(i),{span:24},{default:a(()=>[v("支撑的毕业要求指标点")]),_:1})]),_:1}),l(e(z),{class:"sub-row"},{default:a(()=>[l(e(i),{span:8},{default:a(()=>[v("指标点代号")]),_:1}),l(e(i),{span:6},{default:a(()=>[v("支撑强度")]),_:1}),l(e(i),{span:6},{default:a(()=>[v("支撑比例")]),_:1}),l(e(i),{span:4,class:"no-border"})]),_:1})]),_:1}),l(e(i),{span:11,class:"flex-vertical"},{default:a(()=>[l(e(z),null,{default:a(()=>[l(e(i),{span:24},{default:a(()=>[v("考核项目信息")]),_:1})]),_:1}),l(e(z),{class:"sub-row"},{default:a(()=>[l(e(i),{span:4},{default:a(()=>[v("考核类型")]),_:1}),l(e(i),{span:13},{default:a(()=>[v("考核名称")]),_:1}),l(e(i),{span:4},{default:a(()=>[v("所占分值")]),_:1}),l(e(i),{span:3,class:"no-border"})]),_:1})]),_:1})]),_:1}),(y(!0),F(R,null,G(d,n=>(y(),S(e(z),{class:"tbl-data",justify:"center",key:n},{default:a(()=>[l(e(i),{span:3,class:"vh-center"},{default:a(()=>[v(N(n.title),1)]),_:2},1024),l(e(i),{span:3,class:"vh-center"},{default:a(()=>[l(e(H),{type:"primary",style:{width:"60px"},size:"default"},{default:a(()=>[v(N(h(n)),1)]),_:2},1024)]),_:2},1024),l(e(i),{span:7,class:"flex-vertical"},{default:a(()=>[(y(!0),F(R,null,G(n.zhibiaodians,($,I)=>(y(),S(ne,{type:"指标点",data:$,index:I,onDelme:O=>g(n.title,"指标点",I),key:`${n.title}-${$}`},null,8,["data","index","onDelme"]))),128)),l(e(z),null,{default:a(()=>[l(e(i),{span:24},{default:a(()=>[l(e(j),{type:"primary",icon:e(oe),style:{"max-width":"90px"},onClick:$=>p.value.showDialog("指标点",n.title)},{default:a(()=>[v("添加指标点")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l(e(i),{span:11,class:"flex-vertical"},{default:a(()=>[(y(!0),F(R,null,G(n.kaohes,($,I)=>(y(),S(ne,{type:"考核项",data:$,index:I,onDelme:O=>g(n.title,"考核项",I),key:`${n.title}-${$}-${Math.random()}`},null,8,["data","index","onDelme"]))),128)),l(e(z),null,{default:a(()=>[l(e(i),{span:24},{default:a(()=>[l(e(j),{type:"primary",icon:e(oe),style:{"max-width":"100px"},onClick:$=>p.value.showDialog("考核项",n.title)},{default:a(()=>[v("添加考核项目")]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),l(e(z),{class:"tbl-header",justify:"center",style:{"background-color":"var(--el-color-primary-light-9)"}},{default:a(()=>[l(e(i),{span:3,class:"vh-center"},{default:a(()=>[v(" 总计 ")]),_:1}),l(e(i),{span:3,class:"vh-center"},{default:a(()=>[l(e(H),{type:"primary",style:{width:"60px"}},{default:a(()=>[v(N(m.value[0]),1)]),_:1})]),_:1}),l(e(i),{span:7,class:"flex-vertical"}),l(e(i),{span:11,class:"flex-vertical"},{default:a(()=>[l(e(z),{class:"sub-row"},{default:a(()=>[l(e(i),{offset:15,span:6,style:{display:"flex",border:"none","justify-content":"space-around"}},{default:a(()=>[(y(!0),F(R,null,G(f.value,(n,$)=>(y(),S(e(H),{style:{width:"60px","margin-left":"1rem"},type:$===1?"success":"warning",key:`${n}-${Math.random()}`},{default:a(()=>[v(N(n),1)]),_:2},1032,["type"]))),128))]),_:1}),l(e(i),{span:3,class:"no-border"})]),_:1})]),_:1})]),_:1})]),_:1}),l(e(z),{justify:"center",style:{"margin-top":"2rem"}},{default:a(()=>[l(e(i),{span:2},{default:a(()=>[l(e(j),{onClick:b[0]||(b[0]=n=>t.$router.push({name:"set-course-info"}))},{default:a(()=>[v("上一步")]),_:1})]),_:1}),l(e(i),{span:2},{default:a(()=>[l(e(j),{onClick:E},{default:a(()=>[v("下一步")]),_:1})]),_:1})]),_:1}),l(na,{onCourseGoalChanged:o,usedFenshu:f.value,usedWeights:m.value,ref_key:"dlgRef",ref:p},null,8,["usedFenshu","usedWeights"])],64))}},ya=ge(ra,[["__scopeId","data-v-ea883e8f"]]);export{ya as default};
