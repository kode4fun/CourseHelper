import{o as C,bi as I,bY as i,bZ as m,Q as L}from"./index-uDMkNMzh.js";/* empty css                   */import{E as M}from"./index-Bx9ligVW.js";let w=null;function P(c){return new Promise((k,h)=>{if(c){const x=new FileReader;x.onload=function(){k(this.result)},x.readAsArrayBuffer(c)}else h("没有文件!")})}const u=C("正在解析Excel文件....");async function G(c,k=!1,h={},x=new Map){if(!c)return;const N=M.service({fullscreen:!0,text:u});return w||await I(()=>import("./xlsx-CIVhsdtn.js").then(a=>a.x),[]).then(a=>w=a),P(c).then(async a=>{const j=w.read(a,{type:"array"}),_=j.SheetNames[0],d=j.Sheets[_],r=w.utils.sheet_to_json(d,{header:1}),o=r[0].length;u.value="正在解析文件内课程信息...";const n=new Map(r[1][0].split(/ +/).map(e=>e.split("："))),[v,S]=n.get("班级").split("级");n.set("年级",i(v,0)),n.set("班级",S.toString().trim()),n.set("学分",i(n.get("学分")),0);const y={专业:"majority",年级:"grade",班级:"banji",学期:"seminar",课程名称:"coursename",课程编号:"cid",学分:"credits"},f={};[...Object.entries(y)].map(([e,t])=>f[t]=n.get(e));const g=new Map;if(d[m(5,o)]&&d[m(5,o)].v.match(/0\.3/g))f.cjgc=0;else if(d[m(5,o)]&&d[m(5,o)].v.match(/0\.5/g))f.cjgc=1;else throw Error("解析成绩比例分配情况出错！");u.value="正在解析文件内课程目标设置信息...";const l=[r[2],r[4],/^下面各分项/.test(r[5][3])?r[6]:r[5]];for(let e of l)for(let t=0;t<6;t++)t<3?e.shift():e.pop();let b=null;for(let e=0;e<l[0].length;e++){l[0][e]!==""&&(b=l[0][e].replace(/(\r)|(毕业要求指标点)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g).map(p=>p.split(/\*/g)).map(p=>({code:p[0],weight:i(p[1])})),g.set(b,[]));const[t,s]=l[1][e].replace(/(\r)|(\()|(\（)|(\))|(\）)/g,"").split(/\n+/g);g.get(b).push({khlx:t==="过程"?0:1,khmc:s,fenzhi:i(l[2][e])})}if(k){u.value="正在验证数据是否与当前信息一致...";for(let[e,t]of Object.entries(y))if(n.get(e)!==h[t])throw Error(`属性 ${e} 与当前课程设置不符：${n.get(e)} !== ${h[t]}`)}u.value="正在解析文件内学生和成绩信息";const E=[];for(let e=7;e<r.length;e++){const t={scores:[]};for(let s=0;s<o;s++)s===0||s===o-1||(s===1?t.stdId=r[e][s]?r[e][s].toString():"":s===2?t.stdName=r[e][s]:s===o-3?t.stdGuocheng=i(r[e][s],0):s===o-2?t.stdKaoshi=i(r[e][s],0):t.scores.push(i(r[e][s],0)));t.stdId&&t.stdName&&E.push(t)}return f.goalNum=g.size,{readedCourseInfo:f,readedCourseGoals:g,readedStudents:E}}).catch(a=>{throw Error(a)}).finally(()=>{L(()=>N.close())})}export{G as ExcelParser,G as default};
